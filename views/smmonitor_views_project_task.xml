<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista de formulario heredada para vista pestaña de tarea extra y botones inteligentes en tarea -->
    <record id="view_task_form_inherit_smmonitor" model="ir.ui.view">
        <field name="name">project.task.form.inherit.smmonitor</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook/page[@name='sub_tasks_page']" position="after">
                <page name="project_task_smmonitor_page" string="Control RR.SS.">
                    <xpath expr="//notebook/page[@name='project_task_smmonitor_page']" position="inside">
                        <group string="Tipo de Post y Hashtags asociados" col="3">
                            <group class="smm-tsk-htag-col-left">
                                <field name="post_type" string="Tipo de publicación" widget="selection" 
                                    help="Escoge el tipo de publicación que deseas registrar"/>
                            </group>
                            <group class="smm-tsk-htag-col-cent">      
                                <field name="ab_test" string="¿Es test A/B?" widget="selection"
                                    help="Indica en este capo si esta publicación es del tipo Test A/B para que se tenga en 
                                            cuenta en los tiempos de medición que hay que hacer"/>
                            </group>
                            <group class="smm-tsk-htag-col-raight">
                                <field name="smm_hashtag_task_ids" widget="many2many_tags" options="{'color_field': 'color'}"
                                    placeholder="Añade los hashtags que deseas registrar para esta publicación"/>
                            </group>
                        </group>
                        <div class="d-flex justify-content-end mb-3">
                            <button name="action_copy_hashtags" string="Copiar Hashtags" type="object"
                                    class="btn-primary" style="width: 250px !important;"
                                    help="Copia todos los hashtags en texto plano añadiendo '#' delante de cada uno"/>
                        </div>
                    </xpath>
                    <group string="Registros para el análisis" col="2">
                        <group>
                            <field name="temp_datetakesdata" string="Fecha de registro" 
                                help="Introducir el día en formato dd/mm/aaaa con la que se relacionan los datos de la lectura que 
                                        deseas introducir teniendo en cuenta los datos que muestras en la plataforma que estes usando. 
                                        IMPORTANTE: El día no puede ser posterior a hoy, y no más antiguo de un año contando desde 
                                        hoy."/>
                            <field name="temp_interactions" string="Interacciones (CTR)" 
                                help="Las interacciones abarcan todas las acciones que los usuarios pueden 
                                        llevar a cabo con respecto a tu contenido, como: Clics en la publicación o en enlaces. 
                                        Me gusta (likes). Comentarios. Compartidos. Guardados (en plataformas que permiten 
                                        esta opción)."/>
                        </group>
                        <group>
                            <field name="temp_reach" string="Alcance" 
                                help="El alcance ser refiere a la cantidad de personas que han visto tu publicación en base a las 
                                        interacciones y las impresiones. Este módulo, no diferencia entre orgánicas y pagadas. Úsalo 
                                        como mejor te interese, pero con el mismo tipo de valor para todas las entradas para obtener 
                                        estadísticas validas."/>
                            <field name="temp_impressions" string="Impresiones" 
                                help="Las impresiones se refieren al número total de veces que la publicación ha sido mostrado 
                                        en una plataforma (y pantalla del usuario), independientemente de si fue clicado o no. 
                                        Por lo que cada vez que se muestra la publicación en una pantalla se cuenta como 1 impresión 
                                        indistintamente de si se visualiza por el usuario o no."/>
                        </group>
                    </group>
                    <div class="d-flex justify-content-end mb-3">
                        <field name="can_add_analytics" invisible="1"/>
                        <button name="action_add_analytics" string="Añadir registro" type="object"
                            class="btn-primary" style="width: 250px !important;"
                            help="Añade el registro a la tabla de datos"/>
                    </div>
                    <field name="smm_date_task_ids" readonly="0">
                        <tree editable="bottom" create="false" delete="true" class="header_tree_style">
                            <field name="datetakesdata" string="Fecha de registro" readonly="1"/>
                            <field name="engagement" widget="percentage_precision" string="Vinculación % (Egagmt)" digits="[6,2]" readonly="0"/>
                            <field name="interactions" string="Interacciones (CTR)" readonly="0"/>
                            <field name="reach" string="Alcance" readonly="0"/>
                            <field name="impressions" string="Impresiones" readonly="0"/>
                        </tree>
                    </field>
                    <group string="Análisis rápido de Crecimiento en Publicación (Necesarios 2 reg. minimo)" col="4">
                        <group string="Tasa crecimiento de Vinculación %" >
                            <field name="growthrate_engagement" string="de primer a ultimo registro" widget="percentage_precision" 
                                help="La tasa de crecimiento, mide el porcentaje que crece la vinculación de tu audiencia (engagement) en 
                                        base al primer y ultimo registro introducido, expresado en un valor porcentual, por lo que se obtiene 
                                        una relación rápida de cuanto ha crecido en total."/>
                        </group>
                        <group string="Tasa crecimiento de Interacciones %">
                            <field name="growthrate_interactions" string="de primer a ultimo registro" widget="percentage_precision" 
                                help="La tasa de crecimiento, mide el porcentaje que crecen las interacciones que tu audiencia realiza con 
                                        esta publicación, en base al primer y ultimo registro introducido, expresado en valor porcentual, 
                                        en total y si tu audiencia esta interactuando con dicha publicación y haciendo que está llegue a 
                                        más audiencia."/>
                        </group>
                        <group string="Tasa crecimiento de Alcance %">
                            <field name="growthrate_reach" string="de primer a ultimo registro" widget="percentage_precision" 
                                help="La tasa de crecimiento, mide el porcentaje que crece el alcance de esta publicación, en base al primer 
                                        y ultimo registro introducido, expresado en valor porcentual, por lo que se obtiene una relación rápida 
                                        de cuanto ha crecido en total dicho alcance, y dando una idea aproximada de si esta publicación esta 
                                        llegando a más gente."/>
                        </group>
                        <group string="Tasa crecimiento de Impresiones %">
                            <field name="growthrate_impressions" string="de primer a ultimo registro" widget="percentage_precision" 
                                help="La tasa de crecimiento, mide el porcentaje que crecen el las impresiones de esta publicación, en base 
                                        al primer y ultimo registro introducido, expresado en valor porcentual, por lo que se obtiene una 
                                        relación rápida de cuanto ha crecido en total y si es más enseñado por la plataforma a tu audiencia."/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Vista de búsqueda heredada para filtrado de búsqueda de varios proyectos (aún queda mejorar esto) -->
    <record id="view_task_search_inherit_smmonitor" model="ir.ui.view">
        <field name="name">project.task.search.global.smmonitor</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <!-- <field name="smm_hashtag_task_ids"/> -->
                <field name="firstdata_datetakesdata"/>
                <field name="latestdata_datetakesdata"/>
                <separator/>
                <filter string="Tareas con registros de RR.SS." name="firstdata_datetakesdata_enabled" domain="[('firstdata_datetakesdata', '!=', False)]"/>
                <!-- <filter string="Hashtags de la tarea" name="hashtags_of_task" domain="[('id', 'in', smm_hashtag_task_ids)]"/> -->
                <group expand="0" string="Agrupar por">
                    <filter string="Por fecha - Reg. Inic." name="group_by_firstdata_date" context="{'group_by': 'firstdata_datetakesdata:day'}"/>
                    <filter string="Por fecha - Reg. Fina." name="group_by_latestdata_date" context="{'group_by': 'latestdata_datetakesdata:day'}"/>
                </group>
            </xpath>
        </field>
    </record>
</odoo>
