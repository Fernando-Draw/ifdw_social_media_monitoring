<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista de árbol para project.task.smmonitor -->
    <record id="view_task_tree_smmonitor" model="ir.ui.view">
        <field name="name">project.task.tree.smmonitor</field>
        <field name="model">project.task.smmonitor</field>
        <field name="arch" type="xml">
            <tree string="Lista de P.R.S. de Tarea">
                <field name="smmonitor_task_id"/>
                <field name="datetakesdata"/>
                <field name="engagement" widget="percentage_precision"/>
                <field name="interactions"/>
                <field name="reach"/>
                <field name="impressions"/>
            </tree>
        </field>
    </record>

    <!-- Vista de gráfico para project.task.smmonitor -->
    <record id="view_task_graph_smmonitor" model="ir.ui.view">
        <field name="name">project.task.graph.smmonitor</field>
        <field name="model">project.task.smmonitor</field>
        <field name="arch" type="xml">
            <graph string="Graficos de P.R.S. de Tarea">
                <field name="datetakesdata" interval="day"/>
                <field name="engagement" type="measure"/>
                <field name="interactions" type="measure"/>
                <field name="reach" type="measure"/>
                <field name="impressions" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Vista de tabla dinámica para project.task.smmonitor -->
    <record id="view_task_pivot_smmonitor" model="ir.ui.view">
        <field name="name">project.task.pivot.smmonitor</field>
        <field name="model">project.task.smmonitor</field>
        <field name="arch" type="xml">
            <pivot string="Tabla dinámica de P.R.S. de tarea">
                <field name="datetakesdata" interval="day" type="row"/>
                <field name="smmonitor_task_id" type="col"/>
                <field name="engagement" type="measure"/>
                <field name="interactions" type="measure"/>
                <field name="reach" type="measure"/>
                <field name="impressions" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Vista de calendario para project.task.smmonitor -->
    <record id="view_task_calendar_smmonitor" model="ir.ui.view">
        <field name="name">project.task.calendar.smmonitor</field>
        <field name="model">project.task.smmonitor</field>
        <field name="arch" type="xml">
            <calendar string="Fechas de toma de registros de Tarea" date_start="datetakesdata" color="smmonitor_task_id">
                <field name="engagement"/>
                <field name="interactions"/>
                <field name="reach"/>
                <field name="impressions"/>
            </calendar>
        </field>
    </record>

    <!-- Acción para abrir las vistas de project.task.smmonitor -->
    <record id="action_task_smmonitor" model="ir.actions.act_window">
        <field name="name">Análisis RR.SS. Tarea</field>
        <field name="res_model">project.task.smmonitor</field>
        <field name="view_mode">tree,graph,pivot,calendar</field>
    </record>

    <!-- Vista de formulario heredada para project.task -->
    <record id="view_task_form_inherit_smmonitor" model="ir.ui.view">
        <field name="name">project.task.form.inherit.smmonitor</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" type="action" name="%(action_task_smmonitor)d" 
                        context="{'search_default_smmonitor_task_id': active_id}"
                        icon="fa-bar-chart">
                    <field string="Análisis RR.SS. Tarea" name="analytics_count" widget="statinfo"/>
                </button>
            </xpath>
            <xpath expr="//notebook/page[@name='sub_tasks_page']" position="after">
                <page name="smmonitor_page" string="Control RR.SS.">
                    <group string="Introducción de valores" col="3">
                        <group>
                            <field name="temp_datetakesdata" string="Fecha de registro" help="Introducir el día en formato dd/mm/aaaa con la que se relacionan los datos de la lectura que deseas introducir teniendo en cuenta los datos que muestras en la plataforma que estes usando. IMPORTANTE: El día no puede ser posterior a hoy, y no más antiguo de un año contanto desde hoy."/>
                            <field name="user_timezone_offset" invisible="1"/>
                        </group>
                        <group>
                            <field name="temp_engagement" widget="percentage_precision" string="Vinculación % (Egagmt)" digits="[6,2]" help="El ratio de vinculación de tu audiencia (engagement) son las interacciones recibidas por cada 100 personas alcanzadas (interacciones totales / alcance total x 100) expresadas en un valor porcentual."/>
                            <field name="temp_interactions" string="Interacciones (CTR)" help="Las interacciones abarcan todas las acciones que los usuarios pueden llevar a cabo con respecto a tu contenido, como: Clics en la publicación o en enlaces. Me gusta (likes). Comentarios. Compartidos. Guardados (en plataformas que permiten esta opción)."/>
                        </group>
                        <group>
                            <field name="temp_reach" string="Alcance" help="El alcance ser refiere a la cantidad de personas que han visto tu publicación en base a las interacciones y las impresiones. Este módulo, no diferencia entre orgánicas y pagadas. Úsalo como mejor te interese, pero con el mismo tipo de valor para todas las entradas para obtener estadísticas validas."/>
                            <field name="temp_impressions" string="Impresiones" help="Las impresiones se refieren al número total de veces que la publicación ha sido mostrado en una plataforma (y pantalla del usuario), independientemente de si fue clicado o no. Por lo que cada vez que se muestra la publicación en una pantalla se cuenta como 1 impresión indistintamente de si se visualiza por el usuario o no."/>
                        </group>
                    </group>
                    <div class="d-flex justify-content-end mb-3">
                        <field name="can_add_analytics" invisible="1"/>
                        <button name="action_add_analytics"
                            help="Solo se puede añadir registros si algún valor es distinto de 0"
                            string="Añadir registro"
                            type="object"
                            class="btn-primary"
                            style="width: 250px !important;"/>
                    </div>
                    <field name="smmonitor_tabs" readonly="0">
                        <tree editable="bottom" create="false" delete="true" class="header_tree_style">
                            <field name="datetakesdata" string="Fecha de registro" readonly="1"/>
                            <field name="engagement" widget="percentage_precision" string="Vinculación % (Egagmt)" digits="[6,2]" readonly="0"/>
                            <field name="interactions" string="Interacciones (CTR)" readonly="0"/>
                            <field name="reach" string="Alcance" readonly="0"/>
                            <field name="impressions" string="Impresiones" readonly="0"/>
                        </tree>
                    </field>
                    <group string="Análisis rápido de Crecimiento en Publicación (Necesarios 2 reg. minimo)" col="4">
                        <group string="Tasa crecimiento de Vinculación %" >
                            <field name="growthrate_engagement" string="de primer a ultimo registro" widget="percentage_precision" help="La tasa de crecimiento, mide el porcentaje que crece la vinculación de tu audiencia (engagement) en base al primer y ultimo registro introducido, expresado en un valor porcentual, por lo que se obtiene una relación rápida de cuanto ha crecido en total."/>
                        </group>
                        <group string="Tasa crecimiento de Interacciones %">
                            <field name="growthrate_interactions" string="de primer a ultimo registro" widget="percentage_precision" help="La tasa de crecimiento, mide el porcentaje que crecen las interacciones que tu audiencia realiza con esta publicación, en base al primer y ultimo registro introducido, expresado en valor porcentual, por lo que se obtiene una relación rápida de cuanto ha crecido en total y si tu audiencia esta interactuando con dicha publicación y haciendo que está llegue a más audiencia."/>
                        </group>
                        <group string="Tasa crecimiento de Alcance %">
                            <field name="growthrate_reach" string="de primer a ultimo registro" widget="percentage_precision" help="La tasa de crecimiento, mide el porcentaje que crece el alcance de esta publicación, en base al primer y ultimo registro introducido, expresado en valor porcentual, por lo que se obtiene una relación rápida de cuanto ha crecido en total dicho alcance, y dando una idea aproximada de si esta publicación esta llegando a más gente."/>
                        </group>
                        <group string="Tasa crecimiento de Impresiones %">
                            <field name="growthrate_impressions" string="de primer a ultimo registro" widget="percentage_precision" help="La tasa de crecimiento, mide el porcentaje que crecen el las impresiones de esta publicación, en base al primer y ultimo registro introducido, expresado en valor porcentual, por lo que se obtiene una relación rápida de cuanto ha crecido en total y si es más enseñado por la plataforma a tu audiencia."/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Vista de lista/árbol heredada para project.task -->
    <record id="view_task_tree_inherit_smmonitor" model="ir.ui.view">
        <field name="name">project.task.tree.inherit.smmonitor</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2"/>
        <field name="arch" type="xml">
            <field name="stage_id" position="after">
                <field name="firstdata_datetakesdata" optional="show"/>
                <field name="firstdata_engagement" widget="percentage_precision" optional="hide"/>
                <field name="firstdata_reach" optional="hide"/>
                <field name="firstdata_interactions" optional="hide"/>
                <field name="firstdata_impressions" optional="hide"/>
                <field name="growthrate_engagement" widget="percentage_precision" optional="hide"/>
                <field name="growthrate_reach" widget="percentage_precision" optional="hide"/>
                <field name="growthrate_interactions" widget="percentage_precision" optional="hide"/>
                <field name="growthrate_impressions" widget="percentage_precision" optional="hide"/>
                <field name="latestdata_datetakesdata" optional="show"/>
                <field name="latestdata_engagement" widget="percentage_precision" optional="hide"/>
                <field name="latestdata_reach" optional="hide"/>
                <field name="latestdata_interactions" optional="hide"/>
                <field name="latestdata_impressions" optional="hide"/>
            </field>
        </field>
    </record>

    <!-- Vista de tabla dinámica heredada para project.task -->
    <record id="view_task_pivot_inherit_smmonitor" model="ir.ui.view">
        <field name="name">project.task.pivot.inherit.smmonitor</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_project_task_pivot"/>
        <field name="arch" type="xml">
            <pivot position="inside">
                <field name="firstdata_datetakesdata" type="row"/>
                <field name="latestdata_datetakesdata" type="row"/>
                <field name="firstdata_engagement" type="measure"/>
                <field name="firstdata_interactions" type="measure"/>
                <field name="firstdata_reach" type="measure"/>
                <field name="firstdata_impressions" type="measure"/>
                <field name="growthrate_engagement_start_to_first" type="measure"/>
                <field name="growthrate_interactions_start_to_first" type="measure"/>
                <field name="growthrate_reach_start_to_first" type="measure"/>
                <field name="growthrate_impressions_start_to_first" type="measure"/>
                <field name="taverage01_engagement" type="measure"/>
                <field name="taverage01_interactions" type="measure"/>
                <field name="taverage01_reach" type="measure"/>
                <field name="taverage01_impressions" type="measure"/>
                <field name="growthrate_engagement_1_to_2" type="measure"/>
                <field name="growthrate_interactions_1_to_2" type="measure"/>
                <field name="growthrate_reach_1_to_2" type="measure"/>
                <field name="growthrate_impressions_1_to_2" type="measure"/>
                <field name="taverage02_engagement" type="measure"/>
                <field name="taverage02_interactions" type="measure"/>
                <field name="taverage02_reach" type="measure"/>
                <field name="taverage02_impressions" type="measure"/>
                <field name="growthrate_engagement_2_to_3" type="measure"/>
                <field name="growthrate_interactions_2_to_3" type="measure"/>
                <field name="growthrate_reach_2_to_3" type="measure"/>
                <field name="growthrate_impressions_2_to_3" type="measure"/>
                <field name="taverage03_engagement" type="measure"/>
                <field name="taverage03_interactions" type="measure"/>
                <field name="taverage03_reach" type="measure"/>
                <field name="taverage03_impressions" type="measure"/>
                <field name="growthrate_engagement_3_to_4" type="measure"/>
                <field name="growthrate_interactions_3_to_4" type="measure"/>
                <field name="growthrate_reach_3_to_4" type="measure"/>
                <field name="growthrate_impressions_3_to_4" type="measure"/>
                <field name="taverage04_engagement" type="measure"/>
                <field name="taverage04_interactions" type="measure"/>
                <field name="taverage04_reach" type="measure"/>
                <field name="taverage04_impressions" type="measure"/>
                <field name="growthrate_engagement_4_to_5" type="measure"/>
                <field name="growthrate_interactions_4_to_5" type="measure"/>
                <field name="growthrate_reach_4_to_5" type="measure"/>
                <field name="growthrate_impressions_4_to_5" type="measure"/>
                <field name="taverage05_engagement" type="measure"/>
                <field name="taverage05_interactions" type="measure"/>
                <field name="taverage05_reach" type="measure"/>
                <field name="taverage05_impressions" type="measure"/>
                <field name="growthrate_engagement_5_to_6" type="measure"/>
                <field name="growthrate_interactions_5_to_6" type="measure"/>
                <field name="growthrate_reach_5_to_6" type="measure"/>
                <field name="growthrate_impressions_5_to_6" type="measure"/>
                <field name="taverage06_engagement" type="measure"/>
                <field name="taverage06_interactions" type="measure"/>
                <field name="taverage06_reach" type="measure"/>
                <field name="taverage06_impressions" type="measure"/>
                <field name="growthrate_engagement_6_to_7" type="measure"/>
                <field name="growthrate_interactions_6_to_7" type="measure"/>
                <field name="growthrate_reach_6_to_7" type="measure"/>
                <field name="growthrate_impressions_6_to_7" type="measure"/>
                <field name="taverage07_engagement" type="measure"/>
                <field name="taverage07_interactions" type="measure"/>
                <field name="taverage07_reach" type="measure"/>
                <field name="taverage07_impressions" type="measure"/>
                <field name="growthrate_engagement_7_to_8" type="measure"/>
                <field name="growthrate_interactions_7_to_8" type="measure"/>
                <field name="growthrate_reach_7_to_8" type="measure"/>
                <field name="growthrate_impressions_7_to_8" type="measure"/>
                <field name="taverage08_engagement" type="measure"/>
                <field name="taverage08_interactions" type="measure"/>
                <field name="taverage08_reach" type="measure"/>
                <field name="taverage08_impressions" type="measure"/>
                <field name="growthrate_engagement_last_to_end" type="measure"/>
                <field name="growthrate_interactions_last_to_end" type="measure"/>
                <field name="growthrate_reach_last_to_end" type="measure"/>
                <field name="growthrate_impressions_last_to_end" type="measure"/>
                <field name="latestdata_engagement" type="measure"/>
                <field name="latestdata_interactions" type="measure"/>
                <field name="latestdata_reach" type="measure"/>
                <field name="latestdata_impressions" type="measure"/>
                <field name="growthrate_engagement" type="measure"/>
                <field name="growthrate_interactions" type="measure"/>
                <field name="growthrate_reach" type="measure"/>
                <field name="growthrate_impressions" type="measure"/>
                <field name="temp_datetakesdata" invisible="1"/>
                <field name="temp_engagement" invisible="1"/>
                <field name="temp_reach" invisible="1"/>
                <field name="temp_interactions" invisible="1"/>
                <field name="temp_impressions" invisible="1"/>
                <field name="user_timezone_offset" invisible="1"/>
            </pivot>
        </field>
    </record>

    <!-- Vista de gráfico heredada para project.task -->
    <record id="view_task_graph_inherit_smmonitor" model="ir.ui.view">
        <field name="name">project.task.graph.inherit.smmonitor</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_project_task_graph"/>
        <field name="arch" type="xml">
            <graph position="inside">
                <field name="firstdata_datetakesdata" type="row"/>
                <field name="latestdata_datetakesdata" type="row"/>
                <field name="firstdata_engagement" type="measure"/>
                <field name="firstdata_interactions" type="measure"/>
                <field name="firstdata_reach" type="measure"/>
                <field name="firstdata_impressions" type="measure"/>
                <field name="taverage01_engagement" type="measure"/>
                <field name="taverage01_interactions" type="measure"/>
                <field name="taverage01_reach" type="measure"/>
                <field name="taverage01_impressions" type="measure"/>
                <field name="taverage02_engagement" type="measure"/>
                <field name="taverage02_interactions" type="measure"/>
                <field name="taverage02_reach" type="measure"/>
                <field name="taverage02_impressions" type="measure"/>
                <field name="taverage03_engagement" type="measure"/>
                <field name="taverage03_interactions" type="measure"/>
                <field name="taverage03_reach" type="measure"/>
                <field name="taverage03_impressions" type="measure"/>
                <field name="taverage04_engagement" type="measure"/>
                <field name="taverage04_interactions" type="measure"/>
                <field name="taverage04_reach" type="measure"/>
                <field name="taverage04_impressions" type="measure"/>
                <field name="taverage05_engagement" type="measure"/>
                <field name="taverage05_interactions" type="measure"/>
                <field name="taverage05_reach" type="measure"/>
                <field name="taverage05_impressions" type="measure"/>
                <field name="taverage06_engagement" type="measure"/>
                <field name="taverage06_interactions" type="measure"/>
                <field name="taverage06_reach" type="measure"/>
                <field name="taverage06_impressions" type="measure"/>
                <field name="taverage07_engagement" type="measure"/>
                <field name="taverage07_interactions" type="measure"/>
                <field name="taverage07_reach" type="measure"/>
                <field name="taverage07_impressions" type="measure"/>
                <field name="taverage08_engagement" type="measure"/>
                <field name="taverage08_interactions" type="measure"/>
                <field name="taverage08_reach" type="measure"/>
                <field name="taverage08_impressions" type="measure"/>
                <field name="latestdata_engagement" type="measure"/>
                <field name="latestdata_interactions" type="measure"/>
                <field name="latestdata_reach" type="measure"/>
                <field name="latestdata_impressions" type="measure"/>
                <field name="growthrate_engagement_start_to_first" invisible="1"/>
                <field name="growthrate_engagement_1_to_2" invisible="1"/>
                <field name="growthrate_engagement_2_to_3" invisible="1"/>
                <field name="growthrate_engagement_3_to_4" invisible="1"/>
                <field name="growthrate_engagement_4_to_5" invisible="1"/>
                <field name="growthrate_engagement_5_to_6" invisible="1"/>
                <field name="growthrate_engagement_6_to_7" invisible="1"/>
                <field name="growthrate_engagement_7_to_8" invisible="1"/>
                <field name="growthrate_engagement_last_to_end" invisible="1"/>
                <field name="growthrate_interactions_start_to_first" invisible="1"/>
                <field name="growthrate_interactions_1_to_2" invisible="1"/>
                <field name="growthrate_interactions_2_to_3" invisible="1"/>
                <field name="growthrate_interactions_3_to_4" invisible="1"/>
                <field name="growthrate_interactions_4_to_5" invisible="1"/>
                <field name="growthrate_interactions_5_to_6" invisible="1"/>
                <field name="growthrate_interactions_6_to_7" invisible="1"/>
                <field name="growthrate_interactions_7_to_8" invisible="1"/>
                <field name="growthrate_interactions_last_to_end" invisible="1"/>
                <field name="growthrate_reach_start_to_first" invisible="1"/>
                <field name="growthrate_reach_1_to_2" invisible="1"/>
                <field name="growthrate_reach_2_to_3" invisible="1"/>
                <field name="growthrate_reach_3_to_4" invisible="1"/>
                <field name="growthrate_reach_4_to_5" invisible="1"/>
                <field name="growthrate_reach_5_to_6" invisible="1"/>
                <field name="growthrate_reach_6_to_7" invisible="1"/>
                <field name="growthrate_reach_7_to_8" invisible="1"/>
                <field name="growthrate_reach_last_to_end" invisible="1"/>
                <field name="growthrate_impressions_start_to_first" invisible="1"/>
                <field name="growthrate_impressions_1_to_2" invisible="1"/>
                <field name="growthrate_impressions_2_to_3" invisible="1"/>
                <field name="growthrate_impressions_3_to_4" invisible="1"/>
                <field name="growthrate_impressions_4_to_5" invisible="1"/>
                <field name="growthrate_impressions_5_to_6" invisible="1"/>
                <field name="growthrate_impressions_6_to_7" invisible="1"/>
                <field name="growthrate_impressions_7_to_8" invisible="1"/>
                <field name="growthrate_impressions_last_to_end" invisible="1"/>                
                <field name="growthrate_engagement" invisible="1"/>
                <field name="growthrate_interactions" invisible="1"/>
                <field name="growthrate_reach" invisible="1"/>
                <field name="growthrate_impressions" invisible="1"/>
                <field name="temp_datetakesdata" invisible="1"/>
                <field name="temp_engagement" invisible="1"/>
                <field name="temp_interactions" invisible="1"/>
                <field name="temp_reach" invisible="1"/>
                <field name="temp_impressions" invisible="1"/>
                <field name="user_timezone_offset" invisible="1"/>
            </graph>
        </field>
    </record>

    <!-- Vista de búsqueda heredada para project.task -->
    <record id="view_task_search_inherit_smmonitor" model="ir.ui.view">
        <field name="name">project.task.search.inherit.smmonitor</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <field name="firstdata_datetakesdata"/>
                <field name="latestdata_datetakesdata"/>
                <field name="growthrate_engagement"/>
                <field name="growthrate_interactions"/>
                <field name="growthrate_reach"/>
                <field name="growthrate_impressions"/>
                <field name="temp_datetakesdata" invisible="1"/>
                <field name="temp_engagement" invisible="1"/>
                <field name="temp_interactions" invisible="1"/>
                <field name="temp_reach" invisible="1"/>
                <field name="temp_impressions" invisible="1"/>
                <field name="user_timezone_offset" invisible="1"/>
                <separator/>
                <filter string="Tasa crecimiento Vinculación" name="positive_engagement_growth" domain="[('growthrate_engagement', '>', 0)]"/>
                <filter string="Tasa crecimiento Interacciones" name="positive_interactions_growth" domain="[('growthrate_interactions', '>', 0)]"/>
                <filter string="Tasa crecimiento Alcance" name="positive_reach_growth" domain="[('growthrate_reach', '>', 0)]"/>
                <filter string="Tasa crecimiento Impresiones" name="positive_impressions_growth" domain="[('growthrate_impressions', '>', 0)]"/>
                <group expand="0" string="Group By">
                    <filter string="Mes Inicial" name="group_by_first_month" context="{'group_by': 'firstdata_datetakesdata:month'}"/>
                    <filter string="Mes Final" name="group_by_last_month" context="{'group_by': 'latestdata_datetakesdata:month'}"/>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Acción de ventana específica para las métricas de RR.SS. -->
    <record id="action_task_smmonitor_metrics" model="ir.actions.act_window">
        <field name="name">Métricas de RR.SS.</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">graph,tree,form,pivot</field>
        <field name="context">{'search_default_group_by_first_month': 1}</field>
        <field name="domain">[('analytics_count', '>', 0)]</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'graph', 'view_id': ref('view_task_graph_inherit_smmonitor')}),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_task_tree_inherit_smmonitor')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_task_form_inherit_smmonitor')}),
            (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_task_pivot_inherit_smmonitor')})]"/>
    </record>

    <!-- Elemento de menú para acceder a las métricas de RR.SS. -->
    <menuitem id="menu_task_smmonitor_metrics"
              name="Métricas de RR.SS."
              parent="project.menu_project_report"
              action="action_task_smmonitor_metrics"
              sequence="20"/>

</odoo>
